{% extends 'base.html' %}

{% block titulo %}Agenda{% endblock %}

{% block conteudo %}
<h2>Agenda de Pacientes</h2>

<div style="margin-bottom: 20px; display: flex; justify-content: center; gap: 40px; align-items: center; font-size: 20px;">
    <!-- Botões de mês -->
    <a href="{{ url_for('agenda', ano=ano if mes > 1 else ano - 1, mes=mes - 1 if mes > 1 else 12) }}">&#8592; Mês</a>

    <!-- Nome do mês e ano -->
    <div>
        <strong>{{ data_atual.strftime('%B') }}</strong>
        <br>
        <strong>{{ ano }}</strong>
    </div>

    <!-- Botões de mês -->
    <a href="{{ url_for('agenda', ano=ano if mes < 12 else ano + 1, mes=mes + 1 if mes < 12 else 1) }}">Mês &#8594;</a>
</div>

<div style="margin-bottom: 10px; display: flex; justify-content: center; gap: 40px; align-items: center;">
    <!-- Botões de ano -->
    <a href="{{ url_for('agenda', ano=ano - 1, mes=mes) }}">&#8595; Ano</a>
    <a href="{{ url_for('agenda', ano=ano + 1, mes=mes) }}">&#8593; Ano</a>
</div>


{% set primeiro_dia = data_atual.replace(day=1) %}
{% set primeiro_dia_semana = (primeiro_dia.weekday() + 1) % 7 %}
{% set ns = namespace(dia_contador=1) %}
{% set iniciado = False %}

    <table border="1" style="margin: auto; text-align: center;">
        <thead>
            <tr>
                <th>Dom</th>
                <th>Seg</th>
                <th>Ter</th>
                <th>Qua</th>
                <th>Qui</th>
                <th>Sex</th>
                <th>Sáb</th>
            </tr>
        </thead>
        <tbody>
            {% for semana in range(6) %}
            <tr>
                {% for dia_semana in range(7) %}
                    <td>
                        {% if semana == 0 and dia_semana < primeiro_dia_semana %}
                            <!-- Células vazias antes do primeiro dia do mês -->
                        {% elif ns.dia_contador <= dias_mes %}
                            <strong>{{ ns.dia_contador }}</strong>
                            <ul>
                                {% for cliente in clientes %}
                                    {% if cliente.data_cadastro.day == dia_contador and
                                        cliente.data_cadastro.month == mes and
                                        cliente.data_cadastro.year == ano %}
                                        <li>{{ cliente.nome }}</li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                            {% set ns.dia_contador = ns.dia_contador + 1 %}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

<style>
.calendar {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    text-align: center;
}

.calendar th,
.calendar td {
    border: 1px solid #ddd;
    padding: 10px;
    vertical-align: top;
}

.calendar th {
    background-color: #6200ea;
    color: white;
}

.calendar td {
    height: 100px;
    position: relative;
}

.calendar ul {
    margin: 0;
    padding: 0;
    list-style: none;
}

.calendar li {
    font-size: 0.9rem;
    margin-top: 5px;
}
</style>

